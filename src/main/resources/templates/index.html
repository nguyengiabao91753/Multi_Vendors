<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>MultiVendors</title>
    <link
            rel="preconnect"
            href="https://fonts.gstatic.com"
    />
    <link
            rel="stylesheet"
            href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800;900&display=swap"
    />
    <link
            rel="stylesheet"
            href="style/fontawesome-free-5.15.3-web/css/all.min.css"
    />
    <link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/slick-carousel@1.8.1/slick/slick.css"/>
    <link rel="stylesheet" th:href="@{/style/reset.css}"/>
    <link rel="stylesheet" th:href="@{/style/style.css}"/>
    <!-- Bootstrap 5 CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

</head>
<body>

<!-- Modal Bootstrap -->
<div class="modal fade" id="messageModal" tabindex="-1" aria-labelledby="messageModalLabel" aria-hidden="true"
     th:if="${mess}">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header bg-primary text-white">
                <h5 class="modal-title" id="messageModalLabel">Notification</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body text-center">
                <span th:text="${mess}"></span>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>
<script>
    window.addEventListener("DOMContentLoaded", function () {
        const messageModal = document.getElementById('messageModal');
        if (messageModal) {
            const modal = new bootstrap.Modal(messageModal);
            modal.show();
        }
    });
</script>


<th:block th:replace="layout/user-layout :: layout">
    <th:block th:fragment="pageContent">
        <section id="banners">
            <div class="container">
                <div class="banners-inner">
                    <div class="banners-section">
                        <div class="banners-slider">
                            <img th:src="@{/slider/5.png}" alt="slider"/>
                            <img th:src="@{/slider/6.png}" alt="slider"/>
                            <img th:src="@{/slider/13.png}" alt="slider"/>
                            <img th:src="@{/slider/14.png}" alt="slider"/>
                        </div>

                        <ul class="banners-list">
                            <li><a href="#"><img th:src="@{/image/banner/1.jfif}" alt="banner"/></a></li>
                            <li><a href="#"><img th:src="@{/image/banner/2.jfif}" alt="banner"/></a></li>
                        </ul>
                    </div>

                    <div class="banners-nav">
                        <a href="#"><img th:src="@{/image/nav/1.gif}" alt="image"/>Flash Sale Hours</a>
                        <a href="#"><img th:src="@{/image/nav/2.png}" alt="image"/>Everything Cheap - From 1K</a>
                        <a href="#"><img th:src="@{/image/nav/3.png}" alt="image"/>International Goods</a>
                        <a href="#"><img th:src="@{/image/nav/4.png}" alt="image"/>Top-up, Services & Movies</a>
                        <a href="#"><img th:src="@{/image/nav/5.png}" alt="image"/>MultiVendors Mart - Zero Shipping
                            Market</a>
                        <a href="#"><img th:src="@{/image/nav/6.png}" alt="image"/>Extra Free Shipping</a>
                        <a href="#"><img th:src="@{/image/nav/7.png}" alt="image"/>Tech Zone - Electronics Market</a>
                        <a href="#"><img th:src="@{/image/nav/8.png}" alt="image"/>Extra Cashback</a>
                        <a href="#"><img th:src="@{/image/nav/9.png}" alt="image"/>Brand Products - 50% Off</a>
                        <a href="#"><img th:src="@{/image/nav/10.png}" alt="image"/>MultiVendors Premium</a>
                    </div>
                </div>
            </div>
        </section>

        <section id="welcome-banner">
            <div class="container">
                <img th:src="@{/image/banner/3.png}" alt="banner"/>
            </div>
        </section>

        <section id="popular">
            <div class="container">

                <div class="popular-banner">
                    <img th:src="@{/image/banner/4a.jfif}" alt="banner" />
                </div>

                <div class="popular-section">
                    <div class="popular-section-wrapper">

                        <div class="popular-product">
                            <div class="popular-product__title">
                                <h3>Best Selling Products</h3>
                                <a th:href="@{/list}">See More <span>></span></a>
                            </div>
                            <div class="popular-product__list" id="bestSellingProductsList">
                            </div>
                        </div>

                        <!-- Featured Products -->
                        <div class="popular-brand">
                            <div class="popular-brand__title">
                                <h3>Featured Products</h3>
                                <a th:href="@{/list}">See More <span>></span></a>
                            </div>
                            <div class="popular-brand__list" id="mostLikedProductsList">
                                <!-- Products will be injected here -->
                            </div>
                        </div>

                    </div>
                </div>

                <div class="popular-banner">
                    <img th:src="@{/image/banner/4b.jfif}" alt="banner" />
                </div>

            </div>
        </section>

        <section id="category">
            <div class="container">
                <div class="category-inner">
                    <div class="category-title">
                        <h3>Categories</h3>
                    </div>
                    <div class="category-list">
                        <div class="category-list-wrapper">
                            <ul>
                                <li class="category-item">
                                    <a th:href="@{/pageproductbycat(categoryID=1)}">
                                        <img src="https://cdn-icons-png.flaticon.com/512/869/869636.png"
                                             alt="category"/>
                                        <p>Phones</p>
                                    </a>
                                </li>
                                <li class="category-item">
                                    <a th:href="@{/pageproductbycat(categoryID=2)}">
                                        <img src="https://cdn-icons-png.flaticon.com/512/3075/3075977.png"
                                             alt="category"/>
                                        <p>Fashion</p>
                                    </a>
                                </li>
                                <li class="category-item">
                                    <a th:href="@{/pageproductbycat(categoryID=3)}">
                                        <img src="https://cdn-icons-png.flaticon.com/512/1046/1046857.png"
                                             alt="category"/>
                                        <p>Electronics</p>
                                    </a>
                                </li>
                                <li class="category-item">
                                    <a th:href="@{/pageproductbycat(categoryID=4)}">
                                        <img src="https://cdn-icons-png.flaticon.com/512/2331/2331970.png"
                                             alt="category"/>
                                        <p>Home Appliances</p>
                                    </a>
                                </li>
                                <li class="category-item">
                                    <a th:href="@{/pageproductbycat(categoryID=5)}">
                                        <img src="https://cdn-icons-png.flaticon.com/512/1903/1903162.png"
                                             alt="category"/>
                                        <p>Health</p>
                                    </a>
                                </li>
                            </ul>
                        </div>

                        <div class="carousel-arrow--prev">
                            <i class="fas fa-chevron-left"></i>
                        </div>
                        <div class="carousel-arrow--next">
                            <i class="fas fa-chevron-right"></i>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section id="voucher">
            <div class="container">
                <div class="voucher-inner">
                    <div class="voucher-item">
                        <img th:src="@{/image/banner/5.png}" alt="voucher"/>
                    </div>
                    <div class="voucher-item">
                        <img th:src="@{/image/banner/6.jfif}" alt="voucher"/>
                    </div>
                    <div class="voucher-item">
                        <img th:src="@{/image/banner/7.jfif}" alt="voucher"/>
                    </div>
                </div>
            </div>
        </section>

        <style>
            .btn-more-wrapper {
                display: flex;
                justify-content: center;
                margin-top: 20px;
            }
        </style>

        <main id="main">
            <div class="container">
                <div class="main-title">
                    <h3>Products</h3>
                    <div class="main-title-banner">
                        <img th:src="@{/image/banner/8.png }" alt="banner" />
                    </div>
                </div>
                <div class="main-list">
                    <div class="main-list-wrapper" id="productSuggestionList">
                    </div>
                    <div class="btn-more-wrapper">
                        <div class="btn btn-more">
                            <a th:href="@{/list}">See More</a>
                        </div>
                    </div>

                </div>
            </div>
        </main>


        <div id="shopee-skinny-banner">
            <a th:href="@{/list}">
                <img th:src="@{/image/banner/9.png}" alt="image"/>
            </a>
        </div>
    </th:block>
</th:block>


<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script type="text/javascript" src="//cdn.jsdelivr.net/npm/slick-carousel@1.8.1/slick/slick.min.js"></script>
<script type="text/javascript" th:src="@{/js/custom.js}"></script>
<script>
    function renderProductCard(product) {
        return `
      <a href="/detail/${product.id}" class="popular-product__item">
        <div class="popular-product__item-wrapper">
          <div class="img-wrapper">
            <img src="${product.productImage[0].url_Image || 'default-image.jpg'}" alt="${product.productName}" />
          </div>
          <p>₫${Number(product.salePrice).toLocaleString()}</p>
        </div>
      </a>
    `;
    }

    fetch('/api/products/bestSellingProducts')
        .then(res => res.json())
        .then(data => {
            const container = document.getElementById('bestSellingProductsList');
            if (data.length === 0) {
                container.innerHTML = '<p class="none-item">Cannot render</p>';
            } else {
                container.innerHTML = data.map(renderProductCard).join('');
            }
        })
        .catch(() => {
            document.getElementById('bestSellingProductsList').innerHTML = '<p class="none-item">Cannot render</p>';
        });

    fetch('/api/products/mostLikedProducts')
        .then(res => res.json())
        .then(data => {
            const container = document.getElementById('mostLikedProductsList');
            if (data.length === 0) {
                container.innerHTML = '<p class="none-item">Cannot render</p>';
            } else {
                container.innerHTML = data.map(renderProductCard).join('');
            }
        })
        .catch(() => {
            document.getElementById('mostLikedProductsList').innerHTML = '<p class="none-item">Cannot render</p>';
        });
</script>

<script>
    function createProductItem(product) {
        const imageUrl = product.productImage[0].url_Image || 'default-image.jpg';
        const priceFormatted = Number(product.salePrice).toLocaleString();
        const soldFormatted = product.quantity ? Number(product.quantity).toLocaleString() : '0';

        return `
      <div class="main-item">
        <a href="/detail/${product.id}">
          <div class="main-item-link">
            <div class="main-item-link--image">
              <img src="${imageUrl}" alt="${product.productName}" />
            </div>
            <div class="main-item-link--detail">
              <div class="main-item-link--detail-name">
                <h5>${product.productName}</h5>
              </div>
              <div class="main-item-link--detail-price">
                <p class="price"><span>₫</span>${priceFormatted}</p>
                <p class="sole">Stock ${soldFormatted}</p>
              </div>
            </div>
          </div>
          <div class="main-item-link--hover">
            Details
          </div>
        </a>
      </div>
    `;
    }

    fetch('/api/products')
        .then(response => {
            if (!response.ok) throw new Error('Network response was not ok');
            return response.json();
        })
        .then(products => {
            const container = document.getElementById('productSuggestionList');
            if (products.length === 0) {
                container.innerHTML = '<p class="none-item">Cannot render</p>';
            } else {
                container.innerHTML = products.map(createProductItem).join('');
            }
        })
        .catch(error => {
            console.error('Error loading products:', error);
            document.getElementById('productSuggestionList').innerHTML = '<p class="none-item">Cannot render</p>';
        });
</script>

</body>
</html>
